{"ast":null,"code":"import Chatkit from '@pusher/chatkit-client';\nimport axios from 'axios';\n\nfunction sendMessage(event) {\n  event.preventDefault();\n  const _this$state = this.state,\n        newMessage = _this$state.newMessage,\n        currentUser = _this$state.currentUser,\n        currentRoom = _this$state.currentRoom;\n  if (newMessage.trim() === '') return;\n  currentUser.sendMessage({\n    text: newMessage,\n    roomId: \"\".concat(currentRoom.id)\n  });\n  this.setState({\n    newMessage: ''\n  });\n}\n\nfunction handleInput(event) {\n  const _event$target = event.target,\n        value = _event$target.value,\n        name = _event$target.name;\n  this.setState({\n    [name]: value\n  });\n}\n\nfunction connectToRoom(id = 'afa1c12e-b196-4bb4-b940-a1af439328be') {\n  const currentUser = this.state.currentUser;\n  this.setState({\n    messages: []\n  });\n  return currentUser.subscribeToRoom({\n    roomId: \"\".concat(id),\n    messageLimit: 100,\n    hooks: {\n      onMessage: message => {\n        this.setState({\n          messages: [...this.state.messages, message]\n        });\n      },\n      onPresenceChanged: () => {\n        const currentRoom = this.state.currentRoom;\n        this.setState({\n          roomUsers: currentRoom.users.sort(a => {\n            if (a.presence.state === 'online') return -1;\n            return 1;\n          })\n        });\n      }\n    }\n  }).then(currentRoom => {\n    const roomName = currentRoom.customData && currentRoom.customData.isDirectMessage ? currentRoom.customData.userIds.filter(id => id !== currentUser.id)[0] : currentRoom.name;\n    this.setState({\n      currentRoom,\n      roomUsers: currentRoom.users,\n      rooms: currentUser.rooms,\n      roomName\n    });\n  }).catch(console.error);\n}\n\nfunction connectToChatkit(event) {\n  event.preventDefault();\n  const userId = this.state.userId;\n\n  if (userId === null || userId.trim() === '') {\n    alert('Invalid userId');\n    return;\n  }\n\n  this.setState({\n    isLoading: true\n  });\n  axios.post('http://localhost:5200/users', {\n    userId\n  }).then(() => {\n    const tokenProvider = new Chatkit.TokenProvider({\n      url: 'http://localhost:5200/authenticate'\n    });\n    const chatManager = new Chatkit.ChatManager({\n      instanceLocator: 'v1:us1:4811d398-69b5-472e-bfcf-e24d61e97f14',\n      userId,\n      tokenProvider\n    });\n    return chatManager.connect({\n      onAddedToRoom: room => {\n        const rooms = this.state.rooms;\n        this.setState({\n          rooms: [...rooms, room]\n        });\n      }\n    }).then(currentUser => {\n      this.setState({\n        currentUser,\n        showLogin: false,\n        isLoading: false,\n        rooms: currentUser.rooms\n      }, () => connectToRoom.call(this));\n    });\n  }).catch(console.error);\n}\n\nfunction createPrivateRoom(id) {\n  const _this$state2 = this.state,\n        currentUser = _this$state2.currentUser,\n        rooms = _this$state2.rooms;\n  const roomName = \"\".concat(currentUser.id, \"_\").concat(id);\n  const isPrivateChatCreated = rooms.filter(room => {\n    if (room.customData && room.customData.isDirectMessage) {\n      const arr = [currentUser.id, id];\n      const userIds = room.customData.userIds;\n\n      if (arr.sort().join('') === userIds.sort().join('')) {\n        return {\n          room\n        };\n      }\n    }\n\n    return false;\n  });\n\n  if (isPrivateChatCreated.length > 0) {\n    return Promise.resolve(isPrivateChatCreated[0]);\n  }\n\n  return currentUser.createRoom({\n    name: \"\".concat(roomName),\n    private: true,\n    addUserIds: [\"\".concat(id)],\n    customData: {\n      isDirectMessage: true,\n      userIds: [currentUser.id, id]\n    }\n  });\n}\n\nfunction sendDM(id) {\n  createPrivateRoom.call(this, id).then(room => {\n    connectToRoom.call(this, room.id);\n  });\n}\n\nexport { sendMessage, handleInput, connectToRoom, connectToChatkit, sendDM };","map":{"version":3,"sources":["/Users/dheerajthasmaravindranath/hobby/chat-app/client/slack/src/helper.js"],"names":["Chatkit","axios","sendMessage","event","preventDefault","state","newMessage","currentUser","currentRoom","trim","text","roomId","id","setState","handleInput","target","value","name","connectToRoom","messages","subscribeToRoom","messageLimit","hooks","onMessage","message","onPresenceChanged","roomUsers","users","sort","a","presence","then","roomName","customData","isDirectMessage","userIds","filter","rooms","catch","console","error","connectToChatkit","userId","alert","isLoading","post","tokenProvider","TokenProvider","url","chatManager","ChatManager","instanceLocator","connect","onAddedToRoom","room","showLogin","call","createPrivateRoom","isPrivateChatCreated","arr","join","length","Promise","resolve","createRoom","private","addUserIds","sendDM"],"mappings":"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","sourcesContent":["import Chatkit from '@pusher/chatkit-client';\nimport axios from 'axios';\n\nfunction sendMessage(event) {\n  event.preventDefault();\n  const { newMessage, currentUser, currentRoom } = this.state;\n\n  if (newMessage.trim() === '') return;\n\n  currentUser.sendMessage({\n    text: newMessage,\n    roomId: `${currentRoom.id}`,\n  });\n\n  this.setState({\n    newMessage: '',\n  });\n}\n\nfunction handleInput(event) {\n  const { value, name } = event.target;\n\n  this.setState({\n    [name]: value,\n  });\n}\n\nfunction connectToRoom(id = 'afa1c12e-b196-4bb4-b940-a1af439328be') {\n  const { currentUser } = this.state;\n\n  this.setState({\n    messages: [],\n  });\n\n  return currentUser\n    .subscribeToRoom({\n      roomId: `${id}`,\n      messageLimit: 100,\n      hooks: {\n        onMessage: message => {\n          this.setState({\n            messages: [...this.state.messages, message],\n          });\n        },\n        onPresenceChanged: () => {\n          const { currentRoom } = this.state;\n          this.setState({\n            roomUsers: currentRoom.users.sort(a => {\n              if (a.presence.state === 'online') return -1;\n\n              return 1;\n            }),\n          });\n        },\n      },\n    })\n    .then(currentRoom => {\n      const roomName =\n        currentRoom.customData && currentRoom.customData.isDirectMessage\n          ? currentRoom.customData.userIds.filter(\n              id => id !== currentUser.id\n            )[0]\n          : currentRoom.name;\n\n      this.setState({\n        currentRoom,\n        roomUsers: currentRoom.users,\n        rooms: currentUser.rooms,\n        roomName,\n      });\n    })\n    .catch(console.error);\n}\n\nfunction connectToChatkit(event) {\n  event.preventDefault();\n\n  const { userId } = this.state;\n\n  if (userId === null || userId.trim() === '') {\n    alert('Invalid userId');\n    return;\n  }\n\n  this.setState({\n    isLoading: true,\n  });\n\n  axios\n    .post('http://localhost:5200/users', { userId })\n    .then(() => {\n      const tokenProvider = new Chatkit.TokenProvider({\n        url: 'http://localhost:5200/authenticate',\n      });\n\n      const chatManager = new Chatkit.ChatManager({\n        instanceLocator: 'v1:us1:4811d398-69b5-472e-bfcf-e24d61e97f14',\n        userId,\n        tokenProvider,\n      });\n\n      return chatManager\n        .connect({\n          onAddedToRoom: room => {\n            const { rooms } = this.state;\n            this.setState({\n              rooms: [...rooms, room],\n            });\n          },\n        })\n        .then(currentUser => {\n          this.setState(\n            {\n              currentUser,\n              showLogin: false,\n              isLoading: false,\n              rooms: currentUser.rooms,\n            },\n            () => connectToRoom.call(this)\n          );\n        });\n    })\n    .catch(console.error);\n}\n\nfunction createPrivateRoom(id) {\n  const { currentUser, rooms } = this.state;\n  const roomName = `${currentUser.id}_${id}`;\n\n  const isPrivateChatCreated = rooms.filter(room => {\n    if (room.customData && room.customData.isDirectMessage) {\n      const arr = [currentUser.id, id];\n      const { userIds } = room.customData;\n\n      if (arr.sort().join('') === userIds.sort().join('')) {\n        return {\n          room,\n        };\n      }\n    }\n\n    return false;\n  });\n\n  if (isPrivateChatCreated.length > 0) {\n    return Promise.resolve(isPrivateChatCreated[0]);\n  }\n\n  return currentUser.createRoom({\n    name: `${roomName}`,\n    private: true,\n    addUserIds: [`${id}`],\n    customData: {\n      isDirectMessage: true,\n      userIds: [currentUser.id, id],\n    },\n  });\n}\n\nfunction sendDM(id) {\n  createPrivateRoom.call(this, id).then(room => {\n    connectToRoom.call(this, room.id);\n  });\n}\n\nexport { sendMessage, handleInput, connectToRoom, connectToChatkit, sendDM };\n"]},"metadata":{},"sourceType":"module"}